<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>muTimer</title>
	
	<link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
	
	<!-- Apple Touch Icons (—Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤) -->
	<link rel="apple-touch-icon" href="icons/apple-touch-icon-180x180.png" sizes="180x180">
	<link rel="apple-touch-icon" href="icons/apple-touch-icon-167x167.png" sizes="167x167">
	<link rel="apple-touch-icon" href="icons/apple-touch-icon-152x152.png" sizes="152x152">
	<link rel="apple-touch-icon" href="icons/apple-touch-icon-120x120.png" sizes="120x120">
	
	<!-- –ú–∞–Ω–∏—Ñ–µ—Å—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
	<link rel="manifest" href="manifest.json">
	
	<!-- –®—Ä–∏—Ñ—Ç—ã -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

	<link rel="preload" href="/timer/index.html" as="document" fetchpriority="high">
	<style>
		:root {
			--bg-color: #000;
			--bg-color-alt: #011b1c;
			--bg-color-alt-2: #1c0101;
			--text-color: #fff;
			--red900: #7A0919;
			--red600: #DB3323;
			--red500: #FF5230;
			--red100: #FFCCAC;
			--green600: #30DA98;
			--green400: #71FEAB;
			--green900: #0C7970;
			--green1000: #042d29;
			--border-color: rgba(255,255,255,.2);
			--border-red: var(--red900);
			--border-green: var(--green900);
			--grey40: rgba(255,255,255,.4);
			--menu-bg: var(--bg-color-alt);
			--divider: rgba(255,255,255,.1);
			--divider2: rgba(255,255,255,.15);
			--shadow: rgba(0,0,0,.5);

			--radius-outer: 24px;
			--gap: 4vw;
			--gap-mid: 2vw;           
		}

		.night {
			--bg-color: #000;
			--bg-color-alt: #300000;
			--bg-color-alt-2: #300000;
			--text-color: var(--red100);
			--red900: #7A0000;
			--red600: #DB0000;
			--red500: #FF0000;
			--red100: #FF0000;
			--green600: var(--red600);
			--green400: var(--red500);
			--green900: var(--red900);
			--green1000: #500000;
			--border-color: rgba(255,0,0,.2);
			--border-red: var(--red900);
			--border-green: var(--green900);
			--grey40: rgba(255,0,0,.4);
			--menu-bg: var(--bg-color-alt);
			--divider: rgba(255,0,0,.1);
			--divider2: rgba(255,0,0,.15);
			--shadow: rgba(0,0,0,.5);
		}

		html {
			height: 100%;
		}

		body, button {
			font-family: "IBM Plex Sans", sans-serif;
		}

		body {
			font-family: "IBM Plex Sans", sans-serif;
			font-weight: 300;
			background-color: var(--bg-color);
			color: var(--text-color);
			display: flex;
			flex-direction: column;
			padding: 4vw;
			overflow: hidden;
		}
		
		label {
			font-size: 32px;
			line-height: 40px;
			display: flex;
			width: 100%;
			justify-content: space-between;
		}

		.average {
			color: var(--red900);
		}

		input {
			width: 100%;
			font-family: "IBM Plex Sans", serif;
			font-weight: 100;
			padding: 0 0 8px 0;
			height:136px;
			margin: 16px 0;
			box-sizing: border-box;
			border: 0;
			border-radius: var(--radius-outer);
			font-size: 144px;
			text-align: center;
			background-color: transparent;
			outline: 0 solid var(--green400);
			transition: all .2s ease;
		}

		input::placeholder {
			color: var(--grey40);

		}

		button {
			padding: 16px 8vw;
			background: var(--green400);
			color: var(--green900);
			border: none;
			border-radius: var(--radius-outer);
			cursor: pointer;
			transition: opacity 0.3s;
			font-size: 32px;
			line-height: 40px;
			font-weight: 500;
			width: fit-content;
		}

		button:active {
			opacity: 0.8;
		}

		label.green500 {
			color: var(--green600);
		}

		label.red600, h4 {
			color: var(--red600);
		}

		input#totalTime {
			color: var(--green400);
			border-color: var(--green900);
			background-color: var(--bg-color-alt);
		}

		input#totalTime:focus {
			outline: 4px solid var(--green400);
			border-color: transparent;
		}

		input#totalTime::placeholder {
			color: var(--green900);
		}

		input#numTracks {
			color: var(--red600);
			border-color: var(--red900);
			background-color: var(--bg-color-alt-2);
		}

		input#numTracks:focus {
			outline: 4px solid var(--red500);
			border-color: transparent;
		}

		input#numTracks::placeholder {
			color: var(--red900);
		}

		.go {
			width: 100%;
		}

		h4 {
			font-size: 4vw;
			line-height: 8vw;
			font-weight: 400;
			margin: 0;
		}

		h2, h3 {
			margin-bottom: 4px;
			color: var(--green400);
			
		}

		h2 {
			font-size: 3em;
			font-weight: 300;
		}


		h1 {
			padding: 0;
			font-weight: 400;
			margin-top: 0;
			margin-bottom: 0;
			font-size: 16px;
			color: var(--grey40);
		}

		h1.apptitle {
			position: relative;
			top: 16px;
			margin-bottom: 44px;
		}

		p, li {
			font-size: 16px;
		}

		a {
			color: var(--green400);
		}

		hr {
			border: 1px solid var(--divider);
		}

		.form-direction {
			display: flex;
			flex-direction: column;
			gap: var(--gap);
			margin-top: 8px;
			margin-bottom: 32px;
		}

		.status-bar {
			display: flex;
			flex-direction: row;
			gap: var(--gap);
			align-items: center;
		}

		#trackDuration {
			color: var(--green600);
		}

		.input-group {
			
		}

		.curTrack {
			font-size: 48px;
		}

		.trkCount {
			font-size: 20px;
		}

		.blink {
			animation: blink .3s ease-in-out infinite;
			color: var(--red500) !important;
		}

		.timer.main.blink {
			text-shadow: 0 0 16px var(--red500) !important;			
		}

		.blink-pb {
			animation: blink-pb .3s ease-in-out infinite;
			color: var(--red500) !important;
		}

		.trackTimerFrame {
			display: flex;
			flex-direction: column;
			width: 100%;
			gap: var(--gap);
		}

		.perfTimerFrame {
			display: flex;
			flex-direction: column;
			width: 100%;
			gap: var(--gap);
		}

		.row {
			display: flex;
			flex-direction: row;
		}

		.column {
			width: 100%;
		}

		.timer-container {
			margin: 0 0 24px 0;
			display: flex;
			flex-direction: column;
			gap: var(--gap);
		}
		
		/*–¢–∞–π–º–µ—Ä—ã*/
		.timer {
			margin: 16px 0;
			letter-spacing: 2px;
		}

		.timer.main {
			font-size: 32vw;
			line-height: 36vw;
			font-weight: 100;
			color: var(--green400);
			text-shadow: 0 0 16px var(--green400);
		}

		.timer.secondary {
			font-size: 12vw;
			line-height: 16vw;
			font-weight: 300;
			color: var(--red900);
		}
		
		/*–ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã*/
		.progress-container {
			height: 48px;
			background: var(--divider);
			border-radius: var(--radius-outer);
			overflow: hidden;
			position: relative;
			box-shadow: 0px 4px 8px var(--shadow) inset;
		}

		.progress-container .progress-line {
			position: absolute;
			width: 100%;
			height: 2px;
			top: 50%;
			transform: translateY(-50%);
		}

		#trackProgressContainer .progress-line {
			background-color: var(--green400);
		}

		#totalProgressContainer .progress-line {
			background-color: var(--red500);
		}

		.progress-container.total-pb {
			height: fit-content;
		}

		.progress-bar {
			height: 100%;
			position: absolute;
			top:0;
			left: 0;

		}

		#trackProgress {
			background: var(--green400);
		}

		#currentTrack {
			margin: 16px 0;
			color: var(--green400);
		}

		/*–ö–Ω–æ–ø–∫–∏*/
		#resetBtn {
			background: var(--red500);
			color: var(--red100);
			margin: 0 0 32px 0;
		}

		#nextTrackBtn {
			background-color: var(--red900);
			color: var(--red500);
		}

		#nextTrackBtn:disabled {
			opacity: .2;
			background-color: var(--green900);
			color: var(--green400);
		}

		/* –°—Ç–∞—Ç—É—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –∏ —Å—Ç–∞—Ç—É—Å —Å–µ—Ç–∏*/
		#wakeLockStatus, #connectionStatus {
			font-size: 16px;
			color: var(--green400);
			font-variant-emoji: text;
		}

		/* –°—Ç–∏–ª–∏ –¥–ª—è –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é */
		.burger-menu {
			position: fixed;
			top: 8vw;
			right: 8vw;
			z-index: 1000;
		}

		.burger-icon {
			cursor: pointer;
			font-size: 24px;
			line-height: 24px;
			color: var(--grey40);
			padding: 2vw;
			transition: transform 0.3s;
		}

		.menu-content {
			display: none;
			position: absolute;
			left: 0;
			right: 0;
			bottom: 0;
			background: var(--menu-bg);
			border-radius: var(--radius-outer) var(--radius-outer) 0 0;
			padding: 8vw;
			z-index: 1000;
		}

		.menu-container {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.menu-content.show {
			display: block;
			animation: slideDown 0.3s ease;
		}

		.menu-panel {
			display: flex;
			flex-direction: row;
			padding-bottom: 16px;
			border-bottom: 1px solid var(--divider);
			margin-bottom: 16px;
		}

		#hiddenResetBtn {
			background: var(--red500);
			line-height: 24px;
			border: 1px solid var(--border-red);
			color: var(--red900);
			padding: 8px 16px;
			font-size: 16px;
			margin: 0;
			transition: all 0.3s;
			text-wrap: nowrap;
			font-variant-emoji: text;
		}

		button.other {
			background: transparent;
			color: var(--green400);
			font-size: 16px;
			line-height: 44px;
			padding: 8px 16px;
			width: 100%;
			text-align: left;
			font-variant-emoji: text;
		}

		button.other:active {
			background-color: var(--grey40);
		}
		
		/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–µ–Ω—é */
		.menu-backdrop {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.5);
			display: none;
			z-index: 999;
		}


		.about, .help, .settings {
			display: none;
			flex-direction: column;
			position: absolute;
			top: 4vw;
			bottom: 4vw;
			left: 4vw;
			right: 4vw;
			border-radius: var(--radius-outer);
			padding: 8vw;
			background: var(--menu-bg);
			z-index: 1002;
			overflow-y: auto;
			gap: var(--gap);
			font-variant-emoji: text;
		}

		.close {
			position: fixed;
			display: block;
			right: 5vw;
			top: 5vw;
			width: 48px;
			height: 48px;
			font-size: 48px;
			text-align: center;
			vertical-align: middle;
			line-height: 48px;
			color: var(--green400);
		}

		.about.show, .help.show, .settings.show {
			display: flex;
		}

		.typo-block {
			width: 100%;
			height: fit-content;
		}

		.help img {
			width: 72px;
			height: 72px;
		}

		/*–ß–∏–ø—ã –ø—Ä–µ—Å–µ—Ç–æ–≤*/
		.shortcuts {
			display: flex;
			flex-direction: row;
			align-items: center;
			justify-content: left;
			gap: 16px;
		}

		.chips-container {
			margin: 16px 0;
			display: flex;
			flex-direction: row;
			gap: 8px;
		}

		.chips-container .chip {
			width: fit-content;
			display: inline-block;
		}

		.chip, .selector, .preset {
			font-size: 20px;
			line-height: 24px;
			font-weight: 400;
			padding: 8px 16px;
			background-color: var(--green1000);
			color: var(--green400);
			border-radius: var(--radius-outer);
			height: fit-content;
			white-space: nowrap;
		}

		.red .preset {
			background-color: var(--red900);
			color: var(--red500);
		}

		.preset.active {
			background: var(--red500);
			color: var(--red900);
		}

		.chip.active {
			background: var(--green600);
			color: var(--green900);
		}

		.spacer {
			height: 24px;
		}

		/*–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤*/
		.lang-switcher {
			display: flex;
			gap: 8px;
			width: fit-content;
		}

		.lang-btn {
			padding: 8px 16px;
			border-radius: 20px;
			background: var(--surface-300);
			border: none;
			color: var(--text-secondary);
			cursor: pointer;
			transition: all 0.3s;
		}

		.lang-btn.active {
			background: var(--green900);
			color: var(--green400);
		}

		.hor-spacer {
			display: inline-block;
			width: 100%;
		}

		.lic {
			font-size: 12px;
			line-height: 16px;
			color: var(--grey40);
		}


		/* –î–∏–∞–ª–æ–≥–∏ */

		.dialog-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0,0,0,0.7);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 2000;
			animation: fadeIn 0.3s;
		}

		.dialog-container {
			background: var(--bg-color-alt);
			border-radius: var(--radius-outer);
			padding: 24px;
			min-width: 280px;
			max-width: 90vw;
			transform: scale(0.9);
			margin: 48px;
			animation: scaleUp 0.2s forwards;
		}

		.dialog-content p {
			font-size: 8vw;
			margin: 0 0 24px;
			line-height: 10vw;
		}

		.dialog-buttons {
			display: flex;
			gap: var(--gap);
			justify-content: flex-end;
			flex-direction: column-reverse;
		}

		.dialog-buttons button {
			width: 100%;
			padding: 8px 20px;
			border-radius: 20px;
			border: none;
			cursor: pointer;
			font-size: 4vw;
			transition: opacity 0.2s;
		}

		#dialogConfirm {
			background: var(--green1000);
			color: var(--green400); 
		}

		#dialogCancel {
			background: var(--bg-color);
			color: var(--green400);
		}

		/*–¢–û–ß–ö–ò*/
		
		.tracks-progress {
			position: relative;
			z-index: 100;
			width: 100%;
		}

		.tracks-container {
			display: flex;
			gap: 0;
			flex-wrap: wrap;
			justify-content: space-evenly;
			align-items: center;
			padding: 8px 8px;
		}

		.track-dot {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: var(--green1000);
			transition: all 0.3s ease;
			position: relative;
		}

		.track-dot.past {
			background: var(--red900);
			transition: transform 2s ease-in-out;
		}

		.track-dot.current {
			background: var(--red100);
/*		    box-shadow: 0 0 12px var(--red100);*/
			transform: scale(1.61);
			animation: blink 1s infinite;
		}

		.track-dot.current + .track-dot, .track-dot.past:has(+.track-dot.current)  {
			transform: scale(1.16);
		}

		.night .track-dot.current {
			background: var(--red600);
		}

		/* –ê–Ω–∏–º–∞—Ü–∏–∏ */

		/* –î–∏–∞–ª–æ–≥–∏ */
		@keyframes fadeIn {
			from { opacity: 0; }
			to { opacity: 1; }
		}

		@keyframes scaleUp {
			to { transform: scale(1); }
		}	


		/*–ú–∏–≥–∞–Ω–∏–µ*/
		@keyframes blink {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.3; }
		}

		@keyframes blink-pb {
			0%, 100% { background-color: var(--divider2); }
			50% { background-color: var(--divider); }
		}

		/*–ú–µ–Ω—é*/
		@keyframes slideDown {
			from {
				opacity: 0;
				transform: translateY(16px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@keyframes gradient-flow {
			0% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
			100% { background-position: 0% 50%; }
		}

		@keyframes shine {
			0% { transform: translateX(-100%); }
			100% { transform: translateX(200%); }
		}


		@media (orientation: landscape)  {
			body {
				flex-direction: row;
				padding: 0;
				align-items: center;
				justify-content: center;
				height: 100%;
			}

			label {
				font-size: 3vw;
				line-height: 2vw;
			}

			button {
				padding: 16px 4vw;
			}

			#configForm {
				margin-right: 8vw
			}

			.form-direction {
				display: flex;
				flex-direction: row;
				gap: var(--gap-mid);
				margin-bottom: 24px;
			}

			.row {
				flex-direction: column;
			}

			.trackTimerFrame {
				width: 61vw;
			}

			.perfTimerFrame {
				width: 28vw;
				gap: var(--gap-mid);
				justify-content: space-between;
			}

			.timer {
				margin: 0;
			}

			.timer.main {
				font-size: 20vw;
				line-height: 20vw;
				display: inline-block;
				width: 100%;
				text-align: center;

			}

			.burger-menu {
				top: 1vw;
				right: 1vw;
			}

			.timer.secondary {
				font-size: 6vw;
				line-height: 8vw;
			}

			h4 {
				font-size: 2vw;
				line-height: 2vw;
			}
			
			h1 {
				display: none;
			}

			.timer-container {
				flex-direction: row;
				gap: var(--gap);
			}

			#nextTrackBtn, .total-pb.total-pb {
/*				height: 100%;*/
			}

			.spacer {
				display: none;
			}

			.menu-content {
				left: 56vw;
				right: 2vw;
				padding: 2vw;
			}

			.help {
				flex-direction: row;
				gap: 2vw;
				padding: 4vw;
			}

			.dialog-content p {
				font-size: 4vw;
				line-height: 6vw;
			}

			.dialog-buttons {
				gap: var(--gap-mid);
				flex-direction: row;
			}

			.dialog-buttons button {
				font-size: 2vw;
			}


			.about, .help, .settings {
				padding: 4vw;
			}

		}

/*		–î–µ—Å–∫—Ç–æ–ø—ã*/

		@media (min-width: 1024px) and (hover: hover) and (pointer: fine), (orientation: landscape) and (hover: hover) and (pointer: fine) {
			.form-direction {
				flex-direction: column;
			}

			#configForm {
				margin: 0 24vw;
			}

			.apptitle {
				display: block;
			}

			.menu-content {
				left: 56vw;
				right: 2vw;
				padding: 2vw;
				top: 8vw;
				bottom: auto;
				border-radius: var(--radius-outer);
			}


		}

	</style>
		</head>
		<body>
		<!-- –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é -->
		<div class="burger-menu">
			<div class="burger-icon" onclick="toggleMenu()">‚ò∞</div>
		</div>
		<div class="menu-content">
			<div class="menu-container">
				<div class="menu-panel"><button id="hiddenResetBtn" onclick="handleReset()" data-i18n="reset">Reset</button><span class="hor-spacer"></span></div>
				<button class="other" data-i18n="settings" onClick="toggleMenu(); toggleSettings();">Settings</button>
				<button class="other" data-i18n="help" onClick="toggleMenu(); toggleHelp();">Help</button>
				<button class="other" data-i18n="about" onClick="toggleMenu(); toggleAbout();">About</button>
				<button class="other" data-i18n="donate" onClick="location.href='https://www.donationalerts.com/r/annabiosis'" type="button">Donate</button>
			</div>
		</div>
		<div class="about">
			<div class="close" onClick="toggleAbout();">√ó</div>
			<div class="typo-block">
				<h2>muTimer</h2>
				<p data-i18n="about01">–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–∫–∞ –∏ –≤—Å–µ–≥–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è —Ü–µ–ª–∏–∫–æ–º.</p>
				<h3 data-i18n="about02">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
				<ul>
				  <li data-i18n="about03">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–∞–≤–Ω—ã–µ –æ—Ç—Ä–µ–∑–∫–∏</li>
				  <li data-i18n="about04">–ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ</li>
				  <li data-i18n="about05">–†–∞–±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ –∏ –æ—Ñ—Ñ–ª–∞–π–Ω</li>
				  <li data-i18n="about06">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏</li>
				  <li data-i18n="about15">–ù–æ—á–Ω–∞—è —Ç–µ–º–∞</li>
				</ul>
				<h3 data-i18n="about07">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h3>
				<ul>
				  <li data-i18n="about08">–ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
				  <li data-i18n="about09">–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏</li>
				  <li data-i18n="about10">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è</li>
				  <li data-i18n="about11">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ø—è—â–µ–≥–æ —Ä–µ–∂–∏–º–∞</li>
				</ul>
				<h3 data-i18n="about12">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h3>
				<p data-i18n="about13">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ PWA-—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –°–æ—Ö—Ä–∞–Ω–∏ —è—Ä–ª—ã–∫ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äî –ø–æ–ª—É—á–∏—à—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</p>
				<h3 data-i18n="about14">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞</h3>
				<p><a href="https://www.youtube.com/@Annabiosis" target="_blank" data-i18n="authorlink">Annabiosis –∏ –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã</a></p>
				<p class="lic" data-i18n="lic01">This software uses the IBM Plex Sans typeface. IBM Plex Sans ¬© 2017-2020 IBM Corporation, under the SIL Open Font License 1.1. For details, see: <a href='https://github.com/IBM/plex'>https://github.com/IBM/plex</a></p>
			</div>
		</div>

		<div class="help">
			<div class="close" onClick="toggleHelp();">√ó</div>
			<div class="typo-block">
				<h2 data-i18n="help">–ü–æ–º–æ—â—å</h2>
				<p><strong data-i18n="skip">–ü—Ä–æ–ø—É—Å–∫</strong> ‚Äî <span data-i18n="help01">–Ω–∞–∂–∏–º–∞–π—Ç–µ, –µ—Å–ª–∏ —Ä–µ—à–∏–ª–∏ –∑–∞–∫–æ–Ω—á–∏—Ç—å —Ç—Ä–µ–∫ —Ä–∞–Ω—å—à–µ. –í –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω–∞–∂–∏–º–∞—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</span></p>
				<p><strong data-i18n="reset">–°–±—Ä–æ—Å</strong> ‚Äî <span data-i18n="help02">–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä –∏ –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span></p>
<!-- 			<h3 data-i18n="statuses">–°—Ç–∞—Ç—É—Å—ã</h3>
				<p><span data-i18n="help03">üí° ‚Äî —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π</span></p>
				<p><span data-i18n="help04">üì° ‚Äî —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span></p> -->
				<h3 data-i18n="tips">–°–æ–≤–µ—Ç—ã</h3>
				<p data-i18n="tips01">–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—Å–µ–≥–æ –ª–∞–π–≤–∞, –≤–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è –ª–∞–π–≤–∞ –∏ 1 —Ç—Ä–µ–∫</p>
				<p data-i18n="tips02">–ï—Å–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤—ã—Å—Ç—É–ø–∞—Ç—å, –≥–¥–µ –Ω–µ –ª–æ–≤–∏—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –∑–∞—Ä–∞–Ω–µ–µ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω</p>
				<p data-i18n="tips03">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
			</div>
		</div>
		
		<div class="settings">
			<div class="close" onClick="toggleSettings();">√ó</div>
			<div class="typo-block">
				<h2 data-i18n="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
					<div class="blink-settings">
						<h3 data-i18n="blinkIn">–ú–∏–≥–∞—Ç—å –∑–∞</h3>
						<div class="chips-container">
							<div class="chip" data-i18n="sec30" data-seconds="30">30 c.</div>
							<div class="chip" data-i18n="min1" data-seconds="60">1 –º.</div>
							<div class="chip" data-i18n="min15" data-seconds="90">1,5 –º.</div>
							<div class="chip" data-i18n="off" data-seconds="0">–í—ã–∫–ª</div>
						</div>
						<p data-i18n="blinkhelp">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∑–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–µ–∫–∞ —Ç–∞–π–º–µ—Ä –Ω–∞—á–Ω–µ—Ç –º–∏–≥–∞—Ç—å</p>
					</div>
					<hr>
					<div class="night-settings">
						<h3 data-i18n="nightMode">–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º</h3>
						<div class="chips-container">
							<div class="chip" data-i18n="off" data-night="false">–í—ã–∫–ª</div>
							<div class="chip" data-i18n="on" data-night="true">–í–∫–ª</div>
						</div>
						<p data-i18n="nightHelp">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∑–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–µ–∫–∞ —Ç–∞–π–º–µ—Ä –Ω–∞—á–Ω–µ—Ç –º–∏–≥–∞—Ç—å</p>
					</div>
					
			</div>

		</div>

		<!-- –§–æ—Ä–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
		<form id="configForm">
			<h1 class="apptitle">muTimer</h1>
			<div class="form-direction">
				<div class="input-group">
					<label class="green500" data-i18n="totalDuration">Set Duration (min)</label>
					<input type="number" id="totalTime" placeholder="0" pattern="[0-9]*" inputmode="numeric" required>
					<div class="shortcuts">
						<div class="chip" data-minutes="30">30‚Ä≤</div>
						<div class="chip" data-minutes="60">60‚Ä≤</div>
						<div class="chip" data-minutes="90">90‚Ä≤</div>
						<div class="chip" data-minutes="120">120‚Ä≤</div>
					</div>
				</div>
				<div class="input-group">
					<label class="red600"><span data-i18n="tracks">Tracks Count</span> <span class="average"><span data-i18n="each">–ø–æ</span> <span id="averageTimeDisplay">--:--</span></span></label>
					<input type="number" id="numTracks" placeholder="0" pattern="[0-9]*" inputmode="numeric" required>
					<div class="shortcuts red" id="trackPresets"></div>
				</div>
			</div>
			<button type="submit" class="go" data-i18n="start">Go!</button>
		</form>
		<!-- –¢–∞–π–º–µ—Ä -->
		<div id="timers" class="timers" style="display: none;">
			<div class="timer-container">
				

				<div class="trackTimerFrame">
					<h4 class="status-bar">
						<span class="curTrack" id="currentTrack"></span>/<span class="trkCount" id="trackCount"></span> <span id="trackDuration"></span><span id="wakeLockStatus"></span><span id="connectionStatus"></span>
					</h4>
					<div><span id="trackTimer" class="timer main"></span></div>
					<div id="trackProgressContainer" class="progress-container">
						<div id="trackProgress" class="progress-bar"></div>
					</div>
				</div>

				
				<div class="perfTimerFrame">
					<div class="row">
						<div class="column">
							<h4 data-i18n="elapsed">Elapsed</h4>
							<div><span id="elapsedTimer" class="timer secondary"></span></div>
						</div>
						<div class="column">
							<h4 data-i18n="remaining">Remaining</h4>
							<div><span id="remainingTimer" class="timer secondary"></span></div>
						</div>
					</div>
					<div id="totalProgressContainer" class="progress-container total-pb">
						<div class="tracks-progress">
							<div class="tracks-container" id="tracksContainer"></div>
						</div>
						<div id="totalProgress" class="progress-bar" style="background: var(--red500);"></div>
					</div>
					<div class="spacer"></div>
					<button id="nextTrackBtn" onclick="nextTrack()" data-i18n="skip">Skip</button>
				</div>

			</div>
		</div>


		<div class="dialog-overlay" id="dialogOverlay">
			<div class="dialog-container">
				<div class="dialog-content">
					<p id="dialogMessage"></p>
					<div class="dialog-buttons">
						<button id="dialogCancel"></button>
						<button id="dialogConfirm"></button>
					</div>
				</div>
			</div>
		</div>


		<script>
		// –°–ª–æ–≤–∞—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
		const i18n = {
			en: {
				totalDuration: "Total duration",
				tracks: "Tracks",
				start: "Start",
				reset: "üíÄ Reset",
				skip: "Skip",
				currentTrack: "Current track",
				elapsed: "Elapsed",
				remaining: "Remaining",
				confirmReset: "Are you sure you want to reset?",
				performanceEnded: "Performance ended!",
				err_grater: "Enter value gratee than ZERO!",
				about: "About",
				help: "Help", 
				donate: "üëç Support me",
				about01: "Control the timing of each track and the entire performance",
				about02: "Features",
				about03: "Automatic division of total time into equal segments",
				about04: "Recalculation of duration during early transitions",
				about05: "Background and offline operation",
				about06: "Progress visualization with cues",
				about15: "Night Mode",
				about07: "Advantages",
				about08: "No installation required ‚Äî works in the browser",
				about09: "Saves data on accidental closure",
				about10: "Automatic localization",
				about11: "Sleep mode prevention",
				about12: "Technologies",
				about13: "Uses modern PWA standards for cross-platform functionality. Add to home screen ‚Äî get a full-fledged app.",
				about14: "Developer", 
				authorlink: "Annabiosis",
				tips: "Tips", 
				help01: "Click if you want to finish the track early. No need to click otherwise",
				help02: "Completely resets the active timer and all saved data",
				statuses: "Statuses", 
				help03: "üí° ‚Äî screen sleep-mode control status",
				help04: "üì° ‚Äî internet connection status",
				tips01: "To track only the full session, input total time and select 1 track",
				tips02: "If performing where internet is unavailable, verify the app is cached and functions offline in advance",
				tips03: "The app is fully optimized for landscape mode usage", 
				lic01: "Typeface IBM Plex Sans ¬© 2017-2020 IBM Corporation, under the SIL Open Font License 1.1. For details, see: https://github.com/IBM/plex",
				settings: "Settings",
				blinkIn: "Blink in",
				min2: "2‚Ä≤",
				min15: "1.5‚Ä≤",
				min1: "1‚Ä≤",
				sec30: "30‚Ä≤‚Ä≤",
				blinkhelp: "Set timer blink start time before track ends",
				off: "Off",
				on: "On",
				ok: "OK",
				confirm: "Confirm",
				cancel: "Cancel",
				each: "each",
				nightMode: "Night Mode",
				nightHelp: "Makes the interface red so it doesn't blind your eyes in the dark" 
			},
			ru: {
				totalDuration: "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
				tracks: "–¢—Ä–µ–∫–æ–≤",
				start: "–°—Ç–∞—Ä—Ç",
				reset: "üíÄ –°–±—Ä–æ—Å",
				skip: "–ü—Ä–æ–ø—É—Å–∫",
				currentTrack: "–¢–µ–∫—É—â–∏–π —Ç—Ä–µ–∫",
				elapsed: "–ü—Ä–æ—à–ª–æ",
				remaining: "–û—Å—Ç–∞–ª–æ—Å—å",
				confirmReset: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä?",
				performanceEnded: "–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!",
				err_grater:"–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ –ù–û–õ–Ø!",
				about:"–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏",
				help: "–ü–æ–º–æ—â—å", 
				donate: "üëç –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –º–µ–Ω—è",
				about01: "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–∫–∞ –∏ –≤—Å–µ–≥–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è —Ü–µ–ª–∏–∫–æ–º.",
				about02: "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
				about03: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–∞–≤–Ω—ã–µ –æ—Ç—Ä–µ–∑–∫–∏",
				about04: "–ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ",
				about05: "–†–∞–±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ –∏ –æ—Ñ—Ñ–ª–∞–π–Ω",
				about06: "–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏",
				about15: "–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º",
				about07: "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞",
				about08: "–ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ",
				about09: "–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏",
				about10: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è",
				about11: "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ø—è—â–µ–≥–æ —Ä–µ–∂–∏–º–∞",
				about12: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
				about13: "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ PWA-—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –°–æ—Ö—Ä–∞–Ω–∏ —è—Ä–ª—ã–∫ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äî –ø–æ–ª—É—á–∏—à—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.",
				about14: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", 
				authorlink: "Annabiosis",
				tips: "–°–æ–≤–µ—Ç—ã", 
				help01: "–Ω–∞–∂–∏–º–∞–π—Ç–µ, –µ—Å–ª–∏ —Ä–µ—à–∏–ª–∏ –∑–∞–∫–æ–Ω—á–∏—Ç—å —Ç—Ä–µ–∫ —Ä–∞–Ω—å—à–µ. –í –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω–∞–∂–∏–º–∞—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è",
				help02: "–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä –∏ –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
				statuses: "–°—Ç–∞—Ç—É—Å—ã",
				help03: "üí° ‚Äî —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π",
				help04: "üì° ‚Äî —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è",  
				tips01: "–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—Å–µ–≥–æ –ª–∞–π–≤–∞, –≤–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è –ª–∞–π–≤–∞ –∏ 1 —Ç—Ä–µ–∫",
				tips02: "–ï—Å–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤—ã—Å—Ç—É–ø–∞—Ç—å, –≥–¥–µ –Ω–µ –ª–æ–≤–∏—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –∑–∞—Ä–∞–Ω–µ–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω",
				tips03: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", 
				lic01: "–®—Ä–∏—Ñ—Ç IBM Plex Sans ¬© 2017-2020 IBM Corporation, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π SIL Open Font License 1.1. –ü–æ–¥—Ä–æ–±–Ω–µ–µ. For details, see: https://github.com/IBM/plex",
				settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
				blinkIn: "–ú–∏–≥–∞—Ç—å –∑–∞",
				min2: "2‚Ä≤",
				min15: "1,5‚Ä≤",
				min1: "1‚Ä≤",
				sec30: "30‚Ä≤‚Ä≤",
				blinkhelp: "–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∑–∞ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–µ–∫–∞ —Ç–∞–π–º–µ—Ä –Ω–∞—á–Ω–µ—Ç –º–∏–≥–∞—Ç—å",
				off: "–í—ã–∫–ª",
				on: "–í–∫–ª",
				ok: "OK",
				confirm: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
				cancel: "–û—Ç–º–µ–Ω–∞",
				each: "–ø–æ",
				nightMode: "–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º",
				nightHelp: "–°–¥–µ–ª–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫—Ä–∞—Å–Ω—ã–º, —á—Ç–æ–±—ã –Ω–µ —Å–ª–µ–ø–∏—Ç—å –≥–ª–∞–∑–∞ –≤ —Ç–µ–º–Ω–æ—Ç–µ"   
			}
		};


		



		// –î–∏–∞–ª–æ–≥–∏
		class Dialog {
			constructor() {
				this.overlay = document.getElementById('dialogOverlay');
				this.message = document.getElementById('dialogMessage');
				this.confirmBtn = document.getElementById('dialogConfirm');
				this.cancelBtn = document.getElementById('dialogCancel');
				this.initEvents();
			}

			initEvents() {
				this.overlay.addEventListener('click', e => {
					if(e.target === this.overlay) this.hide();
				});
				
				document.addEventListener('keydown', e => {
					if(e.key === 'Escape') this.hide();
				});
			}

			show(options) {
				return new Promise(resolve => {
					this.message.textContent = options.message;
					this.confirmBtn.textContent = options.confirmText || 'OK';
					this.cancelBtn.textContent = options.cancelText || 'Cancel';

					this.confirmBtn.onclick = () => {
						this.hide();
						resolve(true);
					};

					this.cancelBtn.onclick = () => {
						this.hide();
						resolve(false);
					};

					this.cancelBtn.style.display = options.showCancel ? 'block' : 'none';
					this.overlay.style.display = 'flex';
					this.confirmBtn.focus();
				});
			}

			hide() {
				this.overlay.style.display = 'none';
			}
		}


		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
		const customDialog = new Dialog();
		
		// –ù–∞—Å—Ç—Ä–æ–π–∫–∏
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
		let blinkThreshold = localStorage.getItem('blinkThreshold') || 30;
		
		const toggle = document.getElementById('nightModeToggle');
		let isNightMode = localStorage.getItem('nightMode') === 'true';


		function updateTheme() {
			document.body.classList.toggle('night', isNightMode);
		}


		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–∏–ø–æ–≤
		document.querySelectorAll('.blink-settings .chip').forEach(chip => {
			chip.addEventListener('click', function() {
				// –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —á–∏–ø–æ–≤
				document.querySelectorAll('.blink-settings .chip').forEach(c => 
					c.classList.remove('active')
				);
				
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
				blinkThreshold = parseInt(this.dataset.seconds);
				localStorage.setItem('blinkThreshold', blinkThreshold);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
				this.classList.add('active');
			});
		});

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–∏–ø–æ–≤
		document.querySelectorAll('.night-settings .chip').forEach(chip => {
			chip.addEventListener('click', function() {
				// –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —á–∏–ø–æ–≤
				document.querySelectorAll('.night-settings .chip').forEach(c => 
					c.classList.remove('active')
				);
				
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
				isNightMode = (this.dataset.night === 'true');
				localStorage.setItem('nightMode', isNightMode);
				updateTheme();
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
				this.classList.add('active');
			});
		});

		document.getElementById('totalTime').addEventListener('input', updateTrackPresets);

		// –¢–û–ß–ö–ò
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–∫–æ–≤
		function initTracksProgress(totalTracks) {
			const container = document.getElementById('tracksContainer');
			container.innerHTML = '';
			
			for(let i = 1; i <= totalTracks; i++) {
				const dot = document.createElement('div');
				dot.className = 'track-dot';
				dot.dataset.track = i;
				container.appendChild(dot);
			}
		}

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		function updateTracksProgress(currentTrack) {
			const dots = document.querySelectorAll('.track-dot');
			
			dots.forEach((dot, index) => {
				dot.classList.remove('past', 'current');
				
				if(index + 1 < currentTrack) {
					dot.classList.add('past');
				} else if(index + 1 === currentTrack) {
					dot.classList.add('current');
				}
			});
		}

		// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		document.addEventListener('DOMContentLoaded', () => {
			applyTranslations();
			addLanguageSwitcher();
			updateTrackPresets();
			
			const initialValue = document.getElementById('numTracks').value;
			updateActivePreset(initialValue);
			
			document.querySelectorAll('.blink-settings .chip').forEach(chip => {
				if(parseInt(chip.dataset.seconds) === parseInt(blinkThreshold)) {
					chip.classList.add('active');
				}
			});

			document.querySelectorAll('.night-settings .chip').forEach(chip => {
				
				var nightdata = (chip.dataset.night === "true");
				if(nightdata === isNightMode) {
					chip.classList.add('active');
				}
			});
		});


		function calculateTrackPresets(totalMinutes) {
			const presets = {};
			
			[3, 4, 5, 6].forEach(minutes => {
				const count = Math.round(totalMinutes / minutes);
				presets[minutes] = count > 0 ? count : 1;
			});


			return presets;
		}

		document.getElementById('numTracks').addEventListener('input', function() {
			updateActivePreset(this.value);
		});

		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞
		function updateActivePreset(currentValue) {
			const chips = document.querySelectorAll('.preset[data-count]');
			
			// –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å active —É –≤—Å–µ—Ö —á–∏–ø–æ–≤
			chips.forEach(chip => chip.classList.remove('active'));
			
			// –ò—â–µ–º —á–∏–ø —Å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
			const activeChip = Array.from(chips).find(chip => 
				parseInt(chip.dataset.count) === parseInt(currentValue)
			);
			
			if(activeChip) {
				activeChip.classList.add('active');
			}
		}


		function calculateAverageTrackTime() {
			const totalMinutes = parseFloat(document.getElementById('totalTime').value) || 0;
			const numTracks = parseInt(document.getElementById('numTracks').value) || 1;
			
			// –†–∞—Å—á–µ—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
			const totalSeconds = totalMinutes * 60;
			const averageSeconds = totalSeconds / numTracks;
			
			// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
			const minutes = Math.floor(averageSeconds / 60);
			const seconds = Math.round(averageSeconds % 60);
			
			
			return `${minutes}:${seconds.toString().padStart(2, '0')}`;
		}

		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
		function updateAverageTimeDisplay() {
			const displayElement = document.getElementById('averageTimeDisplay');
			
			if(!displayElement) return;
			
			try {
				displayElement.textContent = calculateAverageTrackTime();
			} catch(e) {
				displayElement.textContent = '--:--';
			}
		}

		function keepFirstUniqueValues(obj) {
		  const seenValues = new Set(); // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
		  const result = {};

		  for (const key in obj) {
			const value = obj[key];
			if (!seenValues.has(value)) {
			  seenValues.add(value);
			  result[key] = value;
			}
		  }
		  return result;
		}

		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–æ–≤
		function updateTrackPresets() {
			const totalMinutes = parseInt(document.getElementById('totalTime').value) || 0;
			const totalTracks = parseInt(document.getElementById('numTracks').value) || 0;
			const presets = calculateTrackPresets(totalMinutes);
			const container = document.getElementById('trackPresets');
			
			const tempSet = keepFirstUniqueValues(presets);;
		   
			if (totalMinutes > 0) {

				container.innerHTML = Object.entries(tempSet)
					.map(([minutes, count]) => `
						<div class="preset" 
							 data-minutes="${minutes}" 
							 data-count="${count}"
							 onclick="document.getElementById('numTracks').value = ${count}; updateAverageTimeDisplay(); updateActivePreset(${count});">${count}
						</div>
					`).join('');
			} else {
				container.innerHTML = '<div class="preset disabled">--</div>';
			}
		}


		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
		// function updateConnectionStatus() {
		//     const statusElement = document.getElementById('connectionStatus');
		//     const isOnline = navigator.onLine;
		//     const statusText = isOnline ? 'üì°' : '‚ùó';
		//     statusElement.textContent = statusText;
		// }

		// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ —Å–∏—Å—Ç–µ–º—ã
		const getSystemLanguage = () => {
			const systemLang = navigator.language.split('-')[0];
			return Object.keys(i18n).includes(systemLang) ? systemLang : 'en';
		};

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
		let currentLang = localStorage.getItem('appLang') || getSystemLanguage();

		// –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
		function applyTranslations() {
			const elements = document.querySelectorAll('[data-i18n]');
			
			elements.forEach(el => {
				const key = el.dataset.i18n;
				el.textContent = i18n[currentLang][key] || key;
			});
		}

		// –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —è–∑—ã–∫–æ–≤ –≤ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é
		function addLanguageSwitcher() {
			const menu = document.querySelector('.menu-panel');
			const html = `
				<div class="lang-switcher">
					<button class="lang-btn selector ${currentLang === 'en' ? 'active' : ''}" data-lang="en">EN</button>
					<button class="lang-btn selector ${currentLang === 'ru' ? 'active' : ''}" data-lang="ru">RU</button>
				</div>
			`;
			menu.insertAdjacentHTML('beforeend', html);
		}

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
		document.body.addEventListener('click', e => {
			if(e.target.classList.contains('lang-btn')) {
				currentLang = e.target.dataset.lang;
				localStorage.setItem('appLang', currentLang);
				applyTranslations();
				document.querySelectorAll('.lang-btn').forEach(btn => 
					btn.classList.toggle('active', btn.dataset.lang === currentLang)
				);
			}
		});

		// –ê–ª–µ—Ä—Ç—ã
		function showAlert(message) {
			return customDialog.show({
				message: i18n[currentLang][message],
				showCancel: false,
				confirmText: i18n[currentLang].ok
			});
		}

		function showConfirm(message) {
			return customDialog.show({
				message: i18n[currentLang][message],
				showCancel: true,
				confirmText: i18n[currentLang].confirm,
				cancelText: i18n[currentLang].cancel
			});
		}

		// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', async () => {
				try {
					const registration = await navigator.serviceWorker.register('/sw.js');
					console.log('ServiceWorker Registered');

					 // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ –∫–µ—à–∞
					 function getCacheVersion() {
					   return new Promise((resolve, reject) => {
							if (!navigator.serviceWorker.controller) {
								reject('Service Worker –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
							   	return;
							}

							const messageChannel = new MessageChannel();
							messageChannel.port1.onmessage = event => {
							resolve(event.data); // –í–µ—Ä—Å–∏—è –∫–µ—à–∞ –∏–∑ Service Worker
							};
							messageChannel.port1.onerror = error => {
								reject(error);
							}
							navigator.serviceWorker.controller.postMessage('GET_CACHE_VERSION', [messageChannel.port2]);
					   });
					 }

					 // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ –∫–µ—à–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker
					 getCacheVersion()
					 .then(version => {
						console.log('–í–µ—Ä—Å–∏—è –∫–µ—à–∞:', version);
						document.getElementById('cache-version').textContent = `–í–µ—Ä—Å–∏—è –∫–µ—à–∞: ${version}`; // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
					})
						.catch(error => {
							console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ –∫–µ—à–∞:', error);
						 	document.getElementById('cache-version').textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –∫–µ—à–∞';
					});
					
				} catch (err) {
					console.log('ServiceWorker Registration Error:', err);
				}
			});
		}
















		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
		navigator.serviceWorker.addEventListener('controllerchange', () => {
			window.location.reload();
		});

		let wakeLock = null;
		let intervalId;
		let state = {
			startTime: null,         // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
			totalDuration: null,     // –û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
			originalTracks: null,    // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤
			currentTrack: 1,         // –¢–µ–∫—É—â–∏–π —Ç—Ä–µ–∫
			spentTimes: []           // –ú–∞—Å—Å–∏–≤ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —Ç—Ä–µ–∫–∞–º
		};
		let isMenuOpen = false;

		function toggleMenu() {
			const menu = document.querySelector('.menu-content');
			let backdrop = document.querySelector('.menu-backdrop');
			
			isMenuOpen = !isMenuOpen;
			
			if(isMenuOpen) {
				menu.classList.add('show');
				if(!backdrop) {
					backdrop = document.createElement('div');
					backdrop.className = 'menu-backdrop';
					backdrop.onclick = toggleMenu;
					document.body.appendChild(backdrop);
				}
				backdrop.style.display = 'block';
			} else {
				menu.classList.remove('show');
				if(backdrop) {
					backdrop.style.display = 'none';
				}
			}
		}

	// –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
		function toggleAbout() {
			const help = document.querySelector('.about');
			let backdrop = document.querySelector('.menu-backdrop');
			
			isMenuOpen = !isMenuOpen;
			
			if(isMenuOpen) {
				help.classList.add('show');
				if(!backdrop) {
					backdrop = document.createElement('div');
					backdrop.className = 'menu-backdrop';
					backdrop.onclick = toggleMenu;
					document.body.appendChild(backdrop);
				}
				backdrop.style.display = 'block';
			} else {
				help.classList.remove('show');
				if(backdrop) {
					backdrop.style.display = 'none';
				}
			}
		}

		// –ü–æ–∫–∞–∑ –ø–æ–º–æ—â–∏
		function toggleHelp() {
			const help = document.querySelector('.help');
			let backdrop = document.querySelector('.menu-backdrop');
			
			isMenuOpen = !isMenuOpen;
			
			if(isMenuOpen) {
				help.classList.add('show');
				if(!backdrop) {
					backdrop = document.createElement('div');
					backdrop.className = 'menu-backdrop';
					backdrop.onclick = toggleMenu;
					document.body.appendChild(backdrop);
				}
				backdrop.style.display = 'block';
			} else {
				help.classList.remove('show');
				if(backdrop) {
					backdrop.style.display = 'none';
				}
			}
		}

		// –ü–æ–∫–∞–∑ –ø–æ–º–æ—â–∏
		function toggleSettings() {
			const help = document.querySelector('.settings');
			let backdrop = document.querySelector('.menu-backdrop');
			
			isMenuOpen = !isMenuOpen;
			
			if(isMenuOpen) {
				help.classList.add('show');
				if(!backdrop) {
					backdrop = document.createElement('div');
					backdrop.className = 'menu-backdrop';
					backdrop.onclick = toggleMenu;
					document.body.appendChild(backdrop);
				}
				backdrop.style.display = 'block';
			} else {
				help.classList.remove('show');
				if(backdrop) {
					backdrop.style.display = 'none';
				}
			}
		}

		// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞
		async function requestWakeLock() {
			try {
				if ('wakeLock' in navigator) {
					wakeLock = await navigator.wakeLock.request('screen');
					// document.getElementById('wakeLockStatus').textContent = 'üí°';
				}
			} catch (err) {
				console.error('Wake Lock Error:', err);
			}
		}

		function releaseWakeLock() {
			if (wakeLock !== null && !wakeLock.released) {
				wakeLock.release();
				wakeLock = null;
			}
		}

		// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
		function formatTime(ms) {
			const totalMs = Math.max(0, ms);
			const totalSeconds = Math.floor(totalMs / 1000);
			const mins = Math.floor(totalSeconds / 60);
			const secs = totalSeconds % 60;
			return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
		}

		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		function saveState() {
			localStorage.setItem('timerState', JSON.stringify(state));
		}

		// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		function restoreState() {
			const savedState = localStorage.getItem('timerState');
			if (!savedState) return;

			try {
				const parsed = JSON.parse(savedState);
				const now = Date.now();
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
				if (!parsed.startTime || !parsed.totalDuration || !parsed.originalTracks) {
					localStorage.removeItem('timerState');
					return;
				}

				// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –ª–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ
				const timePassed = now - parsed.startTime;
				if (timePassed >= parsed.totalDuration) {
					localStorage.removeItem('timerState');
					return;
				}

				// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
				state = {
					startTime: parsed.startTime,
					totalDuration: parsed.totalDuration,
					originalTracks: parsed.originalTracks,
					currentTrack: parsed.currentTrack,
					spentTimes: parsed.spentTimes
				};

				// –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞
				const totalSpent = state.spentTimes.reduce((a, b) => a + b, 0);
				const trackDuration = (state.totalDuration - totalSpent) / 
									(state.originalTracks - state.currentTrack + 1);
				const currentTrackElapsed = timePassed - totalSpent;

				// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
				while (currentTrackElapsed > trackDuration && 
					  state.currentTrack < state.originalTracks) {
					state.spentTimes.push(trackDuration);
					state.currentTrack++;
					totalSpent += trackDuration;
					trackDuration = (state.totalDuration - totalSpent) / 
								  (state.originalTracks - state.currentTrack + 1);
				}
				initTracksProgress(state.originalTracks);
				updateTracksProgress(state.currentTrack)
				saveState(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
			} catch (e) {
				console.error('Restoring Error:', e);
				localStorage.removeItem('timerState');
			}
		}

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å–∫"
		function nextTrack() {
			const now = Date.now();
			const totalSpent = state.spentTimes.reduce((a, b) => a + b, 0);
			const currentTrackTime = now - state.startTime - totalSpent;

			if(currentTrackTime <= 0) return;
			
			state.spentTimes.push(currentTrackTime);
			state.currentTrack++;
			
			if(state.currentTrack > state.originalTracks) {
				finishPerformance();
				return;
			}
			
			saveState();
			updateTimers();
			updateTracksProgress(state.currentTrack);
		}

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤
		function updateTimers() {
			const now = Date.now();
			const totalElapsed = now - state.startTime;
			
			if(totalElapsed >= state.totalDuration) {
				finishPerformance();
				return;
			}

			// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏
			const nextTrackBtn = document.getElementById('nextTrackBtn');
			const isLastTrack = state.currentTrack === state.originalTracks;
			nextTrackBtn.disabled = isLastTrack;
			const totalSpent = state.spentTimes.reduce((a, b) => a + b, 0);
			const remainingTracks = state.originalTracks - state.currentTrack + 1;
			const trackDuration = (state.totalDuration - totalSpent) / remainingTracks;
			const trackElapsed = totalElapsed - totalSpent;
			let trackRemaining = trackDuration - trackElapsed;
			const shouldBlink = trackRemaining <= blinkThreshold;

			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
			if(trackRemaining <= 0 && remainingTracks > 1) {
				state.spentTimes.push(trackDuration);
				state.currentTrack++;
				saveState();
				updateTracksProgress(state.currentTrack);
				return updateTimers(); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º
			}

			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
			document.getElementById('currentTrack').textContent = state.currentTrack;
			document.getElementById('trackCount').textContent = `${state.originalTracks}`;
			document.getElementById('trackTimer').textContent = formatTime(trackRemaining);
			document.getElementById('elapsedTimer').textContent = formatTime(totalElapsed);
			document.getElementById('remainingTimer').textContent = formatTime(state.totalDuration - totalElapsed);
			document.getElementById('trackDuration').textContent = formatTime(trackDuration);

			// –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
			const totalProgress = (totalElapsed / state.totalDuration) * 100;
			const trackProgress = (trackElapsed / trackDuration) * 100;
			
			document.getElementById('totalProgress').style.width = `${totalProgress}%`;
			document.getElementById('trackProgress').style.width = `${trackProgress}%`;

			// –ú–∏–≥–∞–Ω–∏–µ
			const trackTimerElement = document.getElementById('trackTimer');
			const trackProgressBar = document.getElementById('trackProgressContainer');
			if (trackRemaining <= blinkThreshold*1000) { // 30 —Å–µ–∫—É–Ω–¥
				trackTimerElement.classList.add('blink');
				trackProgressBar.classList.add('blink-pb');
			} else {
				trackTimerElement.classList.remove('blink');
				trackProgressBar.classList.remove('blink-pb');
			}


		}

		// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è
		function finishPerformance() {
			clearInterval(intervalId);
			showAlert('performanceEnded');
			resetApp();
		}

		// –°–±—Ä–æ—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
		function resetApp() {
			const savedThreshold = localStorage.getItem('blinkThreshold');
			clearInterval(intervalId);
			releaseWakeLock();
			localStorage.removeItem('timerState');
			state = {
				startTime: null,
				totalDuration: null,
				originalTracks: null,
				currentTrack: 1,
				spentTimes: []
			};
			document.getElementById('timers').style.display = 'none';
			document.getElementById('configForm').style.display = 'block';
			document.getElementById('nextTrackBtn').disabled = false;

			if(savedThreshold) localStorage.setItem('blinkThreshold', savedThreshold);
			document.getElementById('tracksContainer').innerHTML = '';
			updateTheme();

		}

		function handleReset() {
			toggleMenu(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
			showConfirm('confirmReset').then(confirmed => {
				if(confirmed) {
					resetApp(); // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
				}
			});
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
		document.getElementById('configForm').addEventListener('submit', (e) => {
			e.preventDefault();
			
			const totalMinutes = parseInt(document.getElementById('totalTime').value);
			const numTracks = parseInt(document.getElementById('numTracks').value);
			
			if(totalMinutes < 1 || numTracks < 1) {
				showAlert('err_grater');
				return;
			}



			state = {
				startTime: Date.now(),
				totalDuration: totalMinutes * 60 * 1000,
				originalTracks: numTracks,
				currentTrack: 1,
				spentTimes: []
			};
			
			saveState();
			requestWakeLock();
			document.getElementById('configForm').style.display = 'none';
			document.getElementById('timers').style.display = 'block';
			intervalId = setInterval(updateTimers, 100);
			updateTimers();
			initTracksProgress(numTracks);
			updateTracksProgress(state.currentTrack);
		});

		// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		window.addEventListener('load', () => {
			// updateConnectionStatus();
			
			// –°–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
			// window.addEventListener('online', updateConnectionStatus);
			// window.addEventListener('offline', updateConnectionStatus);

			restoreState();
			
			if (state.startTime) {
				const timePassed = Date.now() - state.startTime;
				if (timePassed < state.totalDuration) {
					document.getElementById('configForm').style.display = 'none';
					document.getElementById('timers').style.display = 'block';
					intervalId = setInterval(updateTimers, 100);
					requestWakeLock();
					updateTimers();
				} else {
					resetApp();
				}
			}
		});

		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–∏–ø–æ–≤
		document.querySelectorAll('.shortcuts .chip').forEach(chip => {
			chip.addEventListener('click', function() {
				// –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —á–∏–ø–æ–≤
				document.querySelectorAll('.shortcuts .chip').forEach(c => c.classList.remove('active'));
				
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
				const minutes = this.dataset.minutes;
				document.getElementById('totalTime').value = minutes;
				
				// –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É —á–∏–ø—É
				this.classList.add('active');
				
				// –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤
				document.getElementById('totalTime').dispatchEvent(new Event('input'));
			});
		});

		// –°–±—Ä–æ—Å —á–∏–ø–æ–≤ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ
		document.getElementById('totalTime').addEventListener('input', function() {
			const chips = document.querySelectorAll('.chip');
			const currentValue = this.value;
			updateAverageTimeDisplay();
			
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —á–∏–ø–æ–º
			const activeChip = Array.from(chips).find(chip => 
				chip.dataset.minutes === currentValue
			);
			
			if(!activeChip) {
				chips.forEach(chip => chip.classList.remove('active'));
			}
		});

		document.getElementById('numTracks').addEventListener('input', updateAverageTimeDisplay);

		// Wake Lock –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
		document.addEventListener('visibilitychange', () => {
			if(document.visibilityState === 'visible') {
				requestWakeLock();
			}
		});


		updateTheme();
	</script>
</body>
</html>